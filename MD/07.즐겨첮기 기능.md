### ğŸ”· ì¦ê²¨ì°¾ê¸° ê¸°ëŠ¥ êµ¬í˜„í•˜ê¸°

í™ˆ í™”ë©´ ìƒì„¸í™”ë©´, ë‘ ê³³ì— ì¦ê²¨ì°¾ê¸° ê¸°ëŠ¥ì„ ìœ„í•´ í•˜íŠ¸ ëª¨ì–‘ì˜ ì´ë¯¸ì§€ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ë¯¸ì§€ë“¤ì´ ì‹¤ì œë¡œ ë™ì‘í•˜ë„ë¡ ê³µí†µìœ¼ë¡œ ì‚¬ìš©í•  ë·°ë¥¼ ì ìš©í•¨

#### ğŸ‘‰ ObservableObject + @EnvironmentObject ë°˜ì˜

- Store ëŠ” ì•± ì „ë°˜ì— ê±¸ì³ ì‚¬ìš©í•˜ê²Œ ë  ëª¨ë¸ì´ë¯€ë¡œ ì–´ë””ì„œë“  ì‰½ê²Œ ì ‘ê·¼í•˜ê³  í™œìš©í•  ìˆ˜ ìˆë„ë¡ `environmentObject` ë¡œ ë³€ê²½í•´ì¤ë‹ˆë‹¤

```swift
// in Product.swift

// Equatable í”„ë¡œí† ì½œì„ ì¤€ìˆ˜í•˜ëŠ” ê²½ìš° ì´ë¯¸ ë¬´ì—‡ì„ ë¹„êµí•´ì•¼ í• ì§€ íŒë‹¨í•  ìˆ˜ ìˆì–´ì„œ firstIndex(of:) ì™€ ê°™ì€ method ë¥¼ ì‘ì„± í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
extension Product: Equatable {}
```

```swift
// in Store.swift

// environment ë¡œ ì „ì—­ì—ì„œ store ì˜ ëª¨ë¸ì˜ ë°ì´í„°ì— ì ‘ê·¼í•´ì„œ ê°€ì ¸ì˜¤ê¸° ê¹Œë¬¸ì— Store ì˜ type ì„ ObserbableObject ë¡œ í•´ì•¼ í•¨
final class Store: ObservableObject {
	// @Published: products í”„ë¡œí¼í‹°ì— íŠ¹ì • ìƒí’ˆì˜ ë°ì´í„°ê°€ ë³€ê²½ë˜ë©´ ê·¸ ì‚¬ì‹¤ì„ ë·°ë“¤ì´ ì•Œì•„ ì±„ê³  í™”ë©´ì„ ê°±ì‹ í•˜ê¸° ìœ„í•´
	@Published var products: [Product]

	// MARK: Initialization
	// Store ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒì„±ë ë•Œ íŒŒì¼ ì´ë¦„ì„ ë‹¤ë¥¸ ê²ƒìœ¼ë¡œ ì§€ì •í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´, Bundle Extension íŒŒì¼ì—ì„œ ì‘ì„±í•œ ê¸°ëŠ¥ì„ ì´ìš©í•´ì„œ
	// ProductData.json íŒŒì¼ì— ìˆëŠ” ë°ì´í„°ë¥¼ ë³µí˜¸í™”í•˜ì—¬ products í”„ë¡œí¼í‹°ì— ì €ì¥í•  í•©ë‹ˆë‹¤
	init(filename: String = "ProductData.json") {
		self.products = Bundle.main.decode(filename: filename, as: [Product].self)
	}
}

// MARK: Action
// ì¦ê²¨ ì°¾ê¸° ì •ë³´ë¥¼ ë³€ê²½í•˜ëŠ” method
extension Store {
	func toggleFavorite(of product: Product) {
		guard let index = products.firstIndex(of: product) else { return }
		products[index].isFavorite.toggle()
	}
}
```

- `@main ê³¼ Home` ì— Store ì—ì„œ ë³€ê²½ëœ í”„ë¡œí† ì½œê³¼ í™˜ê²½ ê°ì²´ë¥¼ ì•±ì´ˆê¸°ì— ë‚˜íƒ€ ë‚¼ ìˆ˜ ìˆê²Œ ì ìš©í•´ ì¤ë‹ˆë‹¤.

```swift
@main
struct GroceryMartAppApp: App {
	var body: some Scene {
		WindowGroup {
			Home()
				.environmentObject(Store()) // í™˜ê²½ ê°ì²´ ì£¼ì…
		}
	}
}
```

```swift
// in Home.swift

struct Home: View {
	// environment ê°ì²´ ìƒì„±
	@EnvironmentObject private var store: Store

	var body: some View {
		NavigationView {
			List(store.products) { product in
				// ProductDetailView ì—
				NavigationLink(destination: ProductDetailView(product: product)) {
					ProductRow(product: product)
				}

				// navigationTitle ì€ ë„¤ë¹„ê²Œì´ì…˜ ë·°ì˜ ë²”ìœ„ ë°”ê¹¥ì´ ì•„ë‹Œ ì•ˆìª½ì— ì¶”ê°€í•´ì•¼ í•¨
					.navigationTitle("Fruit Mart")
			}
			.listStyle(GroupedListStyle())
		}
	}
}

struct Home_Previews: PreviewProvider {
	static var previews: some View {
		// preview ëŠ” Home ì˜ ìì‹ë·°ì— ì†í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ë³„ê°œë¡œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ì–´ ì¤˜ì•¼ í•¨(Store ê°€ ì‚¬ìš©ëœ ë·°ëŠ” instance ìƒì„± í•´ì¤˜ì•¼ preview ê°€ ì‘ë™í•¨)
		Home()
			.environmentObject(Store())
	}
}
```

#### ğŸ‘‰ FavoriteButton

ì¦ê²¨ì°¾ê¸° ì„¤ì •ì„ ë³€ê²½í•˜ëŠ” ì½”ë“œë¥¼ í˜¸ì¶œí•˜ê³ , ê·¸ ì„¤ì •ì— ë”°ë¼ í•˜íŠ¸ ì´ë¯¸ì§€ ëª¨ì–‘ì„ ë‹¤ë¥´ê²Œ í•˜ëŠ” ë²„íŠ¼ì„ ë§Œë“­ë‹ˆë‹¤

```swift

// in FavoriteButton.swift

struct FavoriteButton: View {
	@EnvironmentObject private var store: Store
	let product: Product

	private var imageName: String {
		// ì¦ê²¨ ì°¾ê¸° ì—¬ë¶€ì— ë”°ë¼ ì‹¬ë²Œ ë³€ê²½
		product.isFavorite ? "heart.fill" : "heart"
	}

	var body: some View {
		Image(systemName: imageName)
			.imageScale(.large)
			.foregroundColor(.peach)
			.frame(width: 32, height: 32)
		// í™ˆí™”ë©´ì—ì„œ ëˆ„ë¥¼ë•Œ ë‚´ë¹„ê²Œì´ì…˜ ë§í¬ê°€ ë¨¼ì € ë°˜ì‘í•´ì„œ ìƒì„¸ í™”ë©´ìœ¼ë¡œ ì´ë™í•´ ë²„ë¦¼
		// onTapGesture ë¥¼ ì‚¬ìš©í•´ ë„¤ë¹„ê²Œì´ì…˜ ë§í¬ë‚˜ ë²„íŠ¼ ê°™ì€ ì»¨íŠ¸ë¡¤ë³´ë‹¤ í„°ì¹˜ ì´ë²¤íŠ¸ì— ìš°ì„ ìˆœìœ„ê°€ ìˆì–´ ì‚¬ìš©ë¨
			// .onTapGesture {
			// 	self.store.toggleFavorite(of: self.product)
			// }
	}
}

struct FavoriteButton_Previews: PreviewProvider {
	static var previews: some View {
		Group {
			FavoriteButton(product: productSamples[0]) // isFavorite false ì¼ ë•Œ
			FavoriteButton(product: productSamples[2]) // isFavorite true ì¼ ë•Œ
		}
		.padding()
		.previewLayout(.sizeThatFits)
	}
}

```

![image](https://user-images.githubusercontent.com/28912774/148500274-e91acd73-f816-4322-9a0c-da9d5aac5322.png)

- ë§Œë“  FavoriteButton ì„ ì ìš©í•©ë‹ˆë‹¤

```swift
//  ProductRow.swift

var priceFavBtn: some View {
.....
	// í•˜íŠ¸ì•„ì´ì½˜ : FavoriteButton ì ìš©
		FavoriteButton(product: product)

....
```

```swift
//  ProductDetailView.swift

	// ìƒí’ˆëª…ê³¼ ì¦ê²¨ì°¾ê¸° ë²„íŠ¼, ìƒí’ˆ ì„¤ëª…ì„ í‘œì‹œí•˜ëŠ” ë·°
	var productDescription: some View {
VStack (alignment: .leading, spacing: 16) {
	HStack {
		Text(product.name) // ìƒí’ˆëª…
			.font(.largeTitle).fontWeight(.medium)
			.foregroundColor(.black)

		Spacer()

		// ì¦ê²¨ì°¾ê¸° ë²„íŠ¼ - í•˜íŠ¸ì•„ì´ì½˜ : FavoriteButton ì ìš©
		FavoriteButton(product: product)
	}
.......
```

<img width="300" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º" src="https://user-images.githubusercontent.com/28912774/148502227-c3301422-6d69-4166-aba1-5869140e41a6.gif">
